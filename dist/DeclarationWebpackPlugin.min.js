"use strict";const a="DeclarationWebpackPlugin";export var moduleType=(o=>(o.commonJS="commonJS",o.esm="esm",o.amd="amd",o.umd="umd",o))(moduleType||{});export class DeclarationWebpackPlugin{outputFile;moduleName;excludedReferences;moduleType;isFileCommented;constructor(i={}){this.outputFile=i?.outputFile||"./build/index.d.ts",this.excludedReferences=i?.excludedReferences||void 0,this.moduleName=i?.moduleName||"",this.moduleType=i?.moduleType||"esm",this.isFileCommented=i?.isFileCommented||!1}apply(i){const{webpack:d}=i,{Compilation:r}=d,{RawSource:o}=d.sources;i.hooks.thisCompilation.tap(a,e=>{e.hooks.processAssets.tap({name:a,stage:r.PROCESS_ASSETS_STAGE_OPTIMIZE},t=>{const s=e.getLogger(a),n={};for(const l in t)s.info(l),l.includes(".d.ts")&&(n[l]=t[l],e.deleteAsset(l));this.generateCombinedDeclaration(n).then(l=>e.emitAsset(this.outputFile,new o(l)))})})}async generateCombinedDeclaration(i){const d=(()=>{let e="";switch(this.moduleType){case"esm":e+=" ?import ?{[a-z0-9 -_]+} ?from.*";break;case"commonJS":e+=" ?import ?([a-z0-9 -_]+) ?= ?require ?(";break;default:e+=" ?import ?{[a-z0-9 -_]+} ?from.*";break}return RegExp(e,"i")})();let r="";for(let e in i){let t=i[e].source().split(`
`),s=t.length;for(;s-- >0;){let n=t[s],l=n==""||d?.test(n)||n.includes("export {}");!l&&this.excludedReferences&&n.includes("<reference")&&(l=this.excludedReferences.some(u=>n.includes(u))),l?t.splice(s,1):(n.includes("declare ")&&(t[s]=n.replace("declare ","")),this.moduleType=="commonJS"&&(t[s]="	"+t[s]))}this.isFileCommented&&(t[0]=`//* ${e} 
`+t[0]),r+=t.join(`
`)+`

`}const o=this.moduleName==""?"MyPackage":this.moduleName;return this.moduleType=="esm"?this.isFileCommented&&`/** declared module "${o}"*/

${r}`||r:this.moduleType=="commonJS"?`declare module "${o}" {
${r}
};`:r}}export function isWebpackPlugin(m){return m==="DeclarationWebpackPlugin"}
