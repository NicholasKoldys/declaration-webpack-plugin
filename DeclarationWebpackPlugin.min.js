const m="DeclarationWebpackPlugin";export var moduleType=(o=>(o.commonJS="commonJS",o.esm="esm",o.amd="amd",o.umd="umd",o))(moduleType||{});export class DeclarationWebpackPlugin{outputFile;moduleName;excludedReferences;moduleType;isFileCommented;constructor(i={}){this.outputFile=i?.outputFile||"./build/index.d.ts",this.excludedReferences=i?.excludedReferences||void 0,this.moduleName=i?.moduleName||"",this.moduleType=i?.moduleType||"esm",this.isFileCommented=i?.isFileCommented||!1}apply(i){const{webpack:d}=i,{Compilation:r}=d,{RawSource:o}=d.sources;i.hooks.thisCompilation.tap(m,e=>{e.hooks.processAssets.tap({name:m,stage:r.PROCESS_ASSETS_STAGE_OPTIMIZE},t=>{const n=e.getLogger(m),s={};for(const l in t)n.info(l),l.includes(".d.ts")&&(s[l]=t[l],e.deleteAsset(l));this.generateCombinedDeclaration(s).then(l=>e.emitAsset(this.outputFile,new o(l)))})})}async generateCombinedDeclaration(i){const d=(()=>{let e="";switch(this.moduleType){case"esm":e+=" ?import ?{[a-z0-9 -_]+} ?from.*";break;case"commonJS":e+=" ?import ?([a-z0-9 -_]+) ?= ?require ?(";break;default:e+=" ?import ?{[a-z0-9 -_]+} ?from.*";break}return RegExp(e,"i")})();let r="";for(let e in i){let t=i[e].source().split(`
`),n=t.length;for(;n-- >0;){let s=t[n],l=s==""||d?.test(s)||s.includes("export {}");!l&&this.excludedReferences&&s.includes("<reference")&&(l=this.excludedReferences.some(u=>s.includes(u))),l?t.splice(n,1):(s.includes("declare ")&&(t[n]=s.replace("declare ","")),this.moduleType=="commonJS"&&(t[n]="	"+t[n]))}this.isFileCommented&&(t[0]=`//* ${e} 
`+t[0]),r+=t.join(`
`)+`

`}const o=this.moduleName==""?"MyPackage":this.moduleName;return this.moduleType=="esm"?this.isFileCommented&&`/** declared module "${o}"*/

${r}`||r:this.moduleType=="commonJS"?`declare module "${o}" {
${r}
};`:r}}
