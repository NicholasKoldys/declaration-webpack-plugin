"use strict";const m="DeclarationWebpackPlugin";export var moduleType=(o=>(o.commonJS="commonJS",o.esm="esm",o.amd="amd",o.umd="umd",o))(moduleType||{});export class DeclarationWebpackPlugin{outputFile;moduleName;excludedReferences;moduleType;isFileCommented;constructor(t={}){this.outputFile=t?.outputFile||"./build/index.d.ts",this.excludedReferences=t?.excludedReferences||void 0,this.moduleName=t?.moduleName||"",this.moduleType=t?.moduleType||"esm",this.isFileCommented=t?.isFileCommented||!1}apply(t){const{webpack:d}=t,{Compilation:r}=d,{RawSource:o}=d.sources;t.hooks.thisCompilation.tap(m,e=>{e.hooks.processAssets.tap({name:m,stage:r.PROCESS_ASSETS_STAGE_OPTIMIZE},i=>{const s=e.getLogger(m),n={};for(const l in i)s.info(l),l.includes(".d.ts")&&(n[l]=i[l],e.deleteAsset(l));this.generateCombinedDeclaration(n).then(l=>e.emitAsset(this.outputFile,new o(l)))})})}async generateCombinedDeclaration(t){const d=(()=>{let e="";switch(this.moduleType){case"esm":e+=" ?import ?{[a-z0-9 -_]+} ?from.*";break;case"commonJS":e+=" ?import ?([a-z0-9 -_]+) ?= ?require ?(";break;default:e+=" ?import ?{[a-z0-9 -_]+} ?from.*";break}return RegExp(e,"i")})();let r="";for(let e in t){let i=t[e].source().split(`
`),s=i.length;for(;s-- >0;){let n=i[s],l=n==""||d?.test(n)||n.includes("export {}");!l&&this.excludedReferences&&n.includes("<reference")&&(l=this.excludedReferences.some(a=>n.includes(a))),l?i.splice(s,1):(n.includes("declare ")&&(i[s]=n.replace("declare ","")),this.moduleType=="commonJS"&&(i[s]="	"+i[s]))}this.isFileCommented&&(i[0]=`//* ${e} 
`+i[0]),r+=i.join(`
`)+`

`}const o=this.moduleName==""?"MyPackage":this.moduleName;return this.moduleType=="esm"?this.isFileCommented&&`/** declared module "${o}"*/

${r}`||r:this.moduleType=="commonJS"?`declare module "${o}" {
${r}
};`:r}}export function isWebpackPlugin(u){return u==="DeclarationWebpackPlugin"}
